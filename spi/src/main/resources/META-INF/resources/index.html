<html>
<head>
    <title>keycloak-spa</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="http://localhost:8080/auth/js/keycloak.js"></script>
    <script>
        var keycloak = new Keycloak({
            url: 'http://localhost:8080/auth',
            realm: 'cryptomator',
            clientId: 'cryptomator-hub'
        });
        keycloak.init({onLoad: 'login-required'}).then(function (response) {
            console.log('User is now authenticated.', response);
        }).catch(function (error) {
            console.error('keycloak init failed', error);
        });

        function makeAjaxRequest() {
            axios.get("/users/me", {
                headers: {
                    'Authorization': 'Bearer ' + keycloak.token
                }
            })
            .then( function (response) {
                console.log("Response: ", response);
            }).catch(function (error) {
                console.log('refreshing');
                keycloak.updateToken(5).then(function () {
                    console.log('Token refreshed');
                }).catch(function (error) {
                    console.log('Failed to refresh token', error);
                });
            });
    }
    </script>
</head>
<body>
    <button onclick="makeAjaxRequest()">Request</button>
</body>
</html>